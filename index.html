<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mosca Exchange</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary: #1a2a6c;
            --secondary: #3a7bd5;
            --buy: #4CAF50;
            --sell: #F44336;
            --light: #f8f9fa;
            --dark: #212529;
            --silver: #e9ecef;
        }
        
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--silver), white);
            color: var(--dark);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        .container {
            max-width: 100%;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            margin: 0;
            font-size: 1.5rem;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .rate-display {
            text-align: center;
            margin: 10px 0;
        }
        
        .rate-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 8px 0;
            transition: all 0.2s;
        }
        
        .btn-buy {
            background: var(--buy);
            color: white;
        }
        
        .btn-sell {
            background: var(--sell);
            color: white;
        }
        
        .btn-nav {
            background: white;
            color: var(--primary);
            border: 1px solid var(--primary);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .refresh-btn {
            background: none;
            border: none;
            color: var(--secondary);
            cursor: pointer;
            margin-top: 5px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div id="main-screen">
        <div class="header">
            <h1>MOSCA EXCHANGE</h1>
        </div>
        
        <div class="container">
            <div class="card">
                <div class="rate-display">
                    <div>–ê–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å:</div>
                    <div class="rate-value" id="buy-rate">-</div>
                    <div class="rate-value" id="sell-rate">-</div>
                    <button class="refresh-btn" id="refresh-rate">‚ü≥ –û–±–Ω–æ–≤–∏—Ç—å –∫—É—Ä—Å</button>
                </div>
            </div>
            
            <button id="buyBtn" class="btn btn-buy">üü¢ –ö—É–ø–∏—Ç—å USDT</button>
            <button id="sellBtn" class="btn btn-sell">üî¥ –ü—Ä–æ–¥–∞—Ç—å USDT</button>
            
            <button id="aboutBtn" class="btn btn-nav">‚ÑπÔ∏è –û –Ω–∞—Å</button>
            <button id="contactsBtn" class="btn btn-nav">üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã</button>
        </div>
    </div>
    
    <div id="form-screen" style="display:none;">
        <div class="header">
            <h1 id="form-title">–û–§–û–†–ú–õ–ï–ù–ò–ï –ó–ê–Ø–í–ö–ò</h1>
        </div>
        
        <div class="container">
            <div class="card">
                <div class="form-group">
                    <label for="amount">–°—É–º–º–∞ (RUB)</label>
                    <input type="number" id="amount" placeholder="1000" required>
                </div>
                
                <div class="form-group">
                    <label for="name">–ü–æ–ª–Ω–æ–µ –§–ò–û</label>
                    <input type="text" id="name" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" required>
                </div>
                
                <div class="form-group">
                    <label for="wallet">–ö–æ—à–µ–ª–µ–∫ USDT (TRC20)</label>
                    <input type="text" id="wallet" placeholder="Txxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" required>
                </div>
                
                <div class="form-group">
                    <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input type="tel" id="phone" placeholder="+79991234567" required>
                </div>
                
                <button id="submitBtn" class="btn btn-buy">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                <button id="backBtn" class="btn btn-nav">‚Üê –ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        let currentOperation = 'buy';
        let currentRate = 0;
        
        async function fetchRate() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=tether&vs_currencies=rub');
                const data = await response.json();
                currentRate = data.tether.rub;
                
                document.getElementById('buy-rate').textContent = `üü¢ –ö—É–ø–∏—Ç—å: ${(currentRate + 1).toFixed(2)}‚ÇΩ`;
                document.getElementById('sell-rate').textContent = `üî¥ –ü—Ä–æ–¥–∞—Ç—å: ${currentRate.toFixed(2)}‚ÇΩ`;
                
                return currentRate;
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞:", error);
                document.getElementById('buy-rate').textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏";
                document.getElementById('sell-rate').textContent = "";
                return null;
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            fetchRate();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            document.getElementById('buyBtn').addEventListener('click', () => {
                currentOperation = 'buy';
                document.getElementById('form-title').textContent = 'üü¢ –ü–û–ö–£–ü–ö–ê USDT';
                document.getElementById('main-screen').style.display = 'none';
                document.getElementById('form-screen').style.display = 'block';
            });
            
            document.getElementById('sellBtn').addEventListener('click', () => {
                currentOperation = 'sell';
                document.getElementById('form-title').textContent = 'üî¥ –ü–†–û–î–ê–ñ–ê USDT';
                document.getElementById('main-screen').style.display = 'none';
                document.getElementById('form-screen').style.display = 'block';
            });
            
            document.getElementById('refresh-rate').addEventListener('click', fetchRate);
            
            document.getElementById('backBtn').addEventListener('click', () => {
                document.getElementById('form-screen').style.display = 'none';
                document.getElementById('main-screen').style.display = 'block';
            });
            
            document.getElementById('submitBtn').addEventListener('click', async () => {
                const rate = await fetchRate();
                if (!rate) {
                    alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫—É—Ä—Å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
                    return;
                }
                
                const effectiveRate = currentOperation === 'buy' ? rate + 1 : rate;
                const data = {
                    type: currentOperation,
                    amount: document.getElementById('amount').value,
                    name: document.getElementById('name').value,
                    wallet: document.getElementById('wallet').value,
                    phone: document.getElementById('phone').value,
                    rate: effectiveRate
                };
                
                if (!data.amount || !data.name || !data.wallet || !data.phone) {
                    alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!");
                    return;
                }
                
                tg.sendData(JSON.stringify(data));
                tg.close();
            });
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.getElementById('aboutBtn').addEventListener('click', () => {
                tg.openTelegramLink('https://t.me/MoscaSupportBot?start=about');
            });
            
            document.getElementById('contactsBtn').addEventListener('click', () => {
                tg.openTelegramLink('https://t.me/MoscaSupportBot?start=contacts');
            });
        });
    </script>
</body>
</html>
